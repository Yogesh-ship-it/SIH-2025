<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cultural Community App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); }
    </style>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Mock data storage in memory
        let nextPostId = 1;
        let nextCommentId = 1;
        const mockUser = { id: 'user-123', name: 'Demo User' };

        const App = () => {
            const [currentView, setCurrentView] = useState('home');
            const [posts, setPosts] = useState([]);
            const [userProfile, setUserProfile] = useState({
                name: 'Demo User',
                bio: 'Welcome to the Cultural Community!',
                profilePictureUrl: ''
            });
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [postToDelete, setPostToDelete] = useState(null);

            const confirmDeletePost = (post) => {
                setPostToDelete(post);
                setShowDeleteModal(true);
            };

            const handleDeleteConfirmed = () => {
                if (postToDelete) {
                    setPosts(prev => prev.filter(p => p.id !== postToDelete.id));
                    setShowDeleteModal(false);
                    setPostToDelete(null);
                }
            };

            return (
                <div className="bg-gray-100 min-h-screen font-sans antialiased text-gray-800 p-4 sm:p-6 lg:p-8">
                    <Header userId={mockUser.id} onNavigate={setCurrentView} />
                    
                    <main className="max-w-4xl mx-auto py-6">
                        {currentView === 'home' && (
                            <HomeView 
                                userId={mockUser.id} 
                                posts={posts} 
                                setPosts={setPosts}
                                confirmDeletePost={confirmDeletePost}
                                userProfile={userProfile}
                            />
                        )}
                        {currentView === 'profile' && (
                            <ProfileView 
                                userId={mockUser.id} 
                                posts={posts}
                                userProfile={userProfile}
                                setUserProfile={setUserProfile}
                                confirmDeletePost={confirmDeletePost}
                                setPosts={setPosts}
                            />
                        )}
                    </main>

                    {showDeleteModal && (
                        <DeleteConfirmationModal
                            onConfirm={handleDeleteConfirmed}
                            onCancel={() => setShowDeleteModal(false)}
                        />
                    )}
                </div>
            );
        };

        const Header = ({ userId, onNavigate }) => (
            <header className="bg-white rounded-xl shadow-md p-4 max-w-4xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
                <div className="flex items-center gap-4">
                    <div className="bg-indigo-600 rounded-full w-10 h-10 flex items-center justify-center text-white font-bold">C</div>
                    <h1 className="text-2xl font-extrabold text-indigo-800">Cultural Community</h1>
                </div>
                <nav className="flex items-center gap-2 flex-wrap">
                    <button
                        onClick={() => onNavigate('home')}
                        className="px-4 py-2 bg-indigo-500 text-white rounded-full shadow-lg transition-transform hover:scale-105"
                    >
                        Home
                    </button>
                    <button
                        onClick={() => onNavigate('profile')}
                        className="px-4 py-2 bg-purple-500 text-white rounded-full shadow-lg transition-transform hover:scale-105"
                    >
                        Profile
                    </button>
                </nav>
                <div className="text-sm text-gray-500 mt-2 sm:mt-0 break-words max-w-[200px] text-right">
                    User: <span className="font-mono text-gray-600">{userId}</span>
                </div>
            </header>
        );

        const HomeView = ({ userId, posts, setPosts, confirmDeletePost, userProfile }) => (
            <div className="flex flex-col gap-6">
                <PostCreator userId={userId} setPosts={setPosts} userProfile={userProfile} />
                <h2 className="text-3xl font-bold text-gray-700 mt-4">Community Stories</h2>
                <div className="grid gap-6">
                    {posts.length > 0 ? (
                        posts.map((post) => (
                            <Post 
                                key={post.id} 
                                post={post} 
                                userId={userId} 
                                confirmDeletePost={confirmDeletePost}
                                setPosts={setPosts}
                            />
                        ))
                    ) : (
                        <div className="text-center text-gray-500 p-8 bg-white rounded-xl shadow-md">
                            <p>No stories yet. Be the first to share a story!</p>
                        </div>
                    )}
                </div>
            </div>
        );

        const ProfileView = ({ userId, posts, userProfile, setUserProfile, confirmDeletePost, setPosts }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [editedProfile, setEditedProfile] = useState(userProfile);

            const userPosts = posts.filter(post => post.userId === userId);

            const fileToBase64 = (file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                });
            };

            const handleFileChange = async (e) => {
                const file = e.target.files[0];
                if (file && file.size <= 1000000) {
                    try {
                        const base64 = await fileToBase64(file);
                        setEditedProfile(prev => ({ ...prev, profilePictureUrl: base64 }));
                    } catch (error) {
                        console.error("Error converting file to base64:", error);
                    }
                }
            };

            const handleSaveProfile = () => {
                setUserProfile(editedProfile);
                // Update all posts with new profile info
                setPosts(prev => prev.map(post => 
                    post.userId === userId 
                        ? { ...post, authorName: editedProfile.name, authorPicture: editedProfile.profilePictureUrl }
                        : post
                ));
                setIsEditing(false);
            };

            const handleCancel = () => {
                setEditedProfile(userProfile);
                setIsEditing(false);
            };

            return (
                <div className="bg-white rounded-xl shadow-md p-6 flex flex-col gap-6">
                    <h2 className="text-2xl font-bold text-gray-700">Your Profile</h2>
                    <div className="flex items-center gap-4">
                        {editedProfile.profilePictureUrl ? (
                            <img src={editedProfile.profilePictureUrl} alt="Profile" className="w-24 h-24 rounded-full object-cover shadow-lg" />
                        ) : (
                            <div className="w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-3xl font-semibold">
                                {editedProfile.name.charAt(0).toUpperCase()}
                            </div>
                        )}
                        <div className="flex-1 flex flex-col gap-2">
                            {isEditing ? (
                                <input
                                    type="text"
                                    value={editedProfile.name}
                                    onChange={(e) => setEditedProfile(prev => ({ ...prev, name: e.target.value }))}
                                    className="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    placeholder="Enter your name"
                                />
                            ) : (
                                <p className="text-xl font-bold">{userProfile.name}</p>
                            )}
                            {isEditing ? (
                                <textarea
                                    value={editedProfile.bio}
                                    onChange={(e) => setEditedProfile(prev => ({ ...prev, bio: e.target.value }))}
                                    rows="3"
                                    className="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"
                                    placeholder="Tell us about yourself..."
                                />
                            ) : (
                                <p className="text-gray-600 italic">{userProfile.bio || 'No bio provided'}</p>
                            )}
                        </div>
                    </div>
                    <div className="flex flex-col sm:flex-row gap-2">
                        {isEditing && (
                            <input
                                type="file"
                                onChange={handleFileChange}
                                className="p-2 border border-gray-300 rounded-lg text-sm"
                                accept="image/*"
                            />
                        )}
                        <button
                            onClick={isEditing ? handleCancel : () => setIsEditing(true)}
                            className={`flex-1 px-4 py-2 rounded-full text-white transition-transform hover:scale-105 ${isEditing ? 'bg-red-500' : 'bg-blue-500'}`}
                        >
                            {isEditing ? 'Cancel' : 'Edit Profile'}
                        </button>
                        {isEditing && (
                            <button
                                onClick={handleSaveProfile}
                                className="flex-1 px-4 py-2 bg-green-500 text-white rounded-full transition-transform hover:scale-105"
                            >
                                Save
                            </button>
                        )}
                    </div>
                    <h3 className="text-xl font-bold text-gray-700 mt-4">Your Recent Stories</h3>
                    <div className="grid gap-4">
                        {userPosts.length > 0 ? (
                            userPosts.map((post) => (
                                <Post 
                                    key={post.id} 
                                    post={post} 
                                    userId={userId} 
                                    confirmDeletePost={confirmDeletePost}
                                    setPosts={setPosts}
                                    isOwnerView={true}
                                />
                            ))
                        ) : (
                            <p className="text-gray-500">You haven't shared any stories yet.</p>
                        )}
                    </div>
                </div>
            );
        };

        const PostCreator = ({ userId, setPosts, userProfile }) => {
            const [postText, setPostText] = useState('');
            const [imageUrl, setImageUrl] = useState('');
            const [uploadedFileName, setUploadedFileName] = useState('');
            const [message, setMessage] = useState('');

            const fileToBase64 = (file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                });
            };

            const handleFileChange = async (e) => {
                const file = e.target.files[0];
                if (file && file.size <= 1000000) {
                    try {
                        const base64 = await fileToBase64(file);
                        setImageUrl(base64);
                        setUploadedFileName(file.name);
                        setMessage('');
                    } catch (error) {
                        setMessage("Error uploading image. Please try again.");
                        setImageUrl('');
                        setUploadedFileName('');
                    }
                } else if (file) {
                    setMessage("File is too large (max 1MB). Please select a smaller image.");
                    setImageUrl('');
                    setUploadedFileName('');
                } else {
                    setImageUrl('');
                    setUploadedFileName('');
                }
            };

            const handleCreatePost = () => {
                if (!postText.trim() && !imageUrl) {
                    setMessage("Story must have text or an image.");
                    return;
                }

                const newPost = {
                    id: nextPostId++,
                    userId,
                    authorName: userProfile.name,
                    authorPicture: userProfile.profilePictureUrl,
                    text: postText.trim(),
                    imageUrl: imageUrl,
                    timestamp: new Date(),
                    likes: 0,
                    likedBy: [],
                    comments: []
                };

                setPosts(prev => [newPost, ...prev]);
                setPostText('');
                setImageUrl('');
                setUploadedFileName('');
                setMessage('Story shared successfully!');
                
                setTimeout(() => setMessage(''), 3000);
            };

            return (
                <div className="bg-white rounded-xl shadow-md p-6 flex flex-col gap-4">
                    <h2 className="text-2xl font-bold text-gray-700">Share Your Story</h2>
                    {message && (
                        <div className={`text-center p-2 rounded-lg text-sm ${
                            message.includes('success') 
                                ? 'bg-green-100 text-green-700' 
                                : message.includes('Error') || message.includes('large') || message.includes('must have')
                                ? 'bg-red-100 text-red-700'
                                : 'bg-indigo-100 text-indigo-700'
                        }`}>
                            {message}
                        </div>
                    )}

                    <textarea
                        value={postText}
                        onChange={(e) => setPostText(e.target.value)}
                        rows="3"
                        placeholder="Tell us a story about your cultural heritage..."
                        className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"
                    />

                    <label className="flex-1 p-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer text-gray-500 hover:border-gray-500 transition-colors text-center">
                        <input type="file" onChange={handleFileChange} className="hidden" accept="image/*" />
                        {uploadedFileName ? `Image selected: ${uploadedFileName}` : 'Click to upload an image (max 1MB)'}
                    </label>

                    {imageUrl && (
                        <div className="flex flex-col items-center p-4 border border-dashed border-gray-300 rounded-lg">
                            <p className="text-sm text-gray-500 mb-2">Image Preview:</p>
                            <img src={imageUrl} alt="Uploaded" className="rounded-lg shadow-lg w-full h-auto max-h-96 object-contain" />
                            <button 
                                onClick={() => {setImageUrl(''); setUploadedFileName('');}}
                                className="mt-2 text-red-500 text-sm hover:text-red-700"
                            >
                                Remove Image
                            </button>
                        </div>
                    )}

                    <button
                        onClick={handleCreatePost}
                        disabled={!postText.trim() && !imageUrl}
                        className="bg-green-500 text-white font-bold py-3 rounded-lg shadow-lg transition-transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        Share Story
                    </button>
                </div>
            );
        };

        const Post = ({ post, userId, confirmDeletePost, setPosts }) => {
            const [showComments, setShowComments] = useState(false);
            const [newCommentText, setNewCommentText] = useState('');
            const userHasLiked = post.likedBy.includes(userId);

            const handleLike = () => {
                setPosts(prev => prev.map(p => {
                    if (p.id === post.id) {
                        const newLikedBy = userHasLiked 
                            ? p.likedBy.filter(id => id !== userId)
                            : [...p.likedBy, userId];
                        return {
                            ...p,
                            likes: newLikedBy.length,
                            likedBy: newLikedBy
                        };
                    }
                    return p;
                }));
            };

            const handleAddComment = () => {
                if (!newCommentText.trim()) return;
                
                const newComment = {
                    id: nextCommentId++,
                    userId,
                    authorName: 'Demo User',
                    text: newCommentText.trim(),
                    timestamp: new Date()
                };

                setPosts(prev => prev.map(p => {
                    if (p.id === post.id) {
                        return {
                            ...p,
                            comments: [...p.comments, newComment]
                        };
                    }
                    return p;
                }));

                setNewCommentText('');
            };

            return (
                <div className="bg-white rounded-xl shadow-md p-6 flex flex-col gap-4">
                    <div className="flex items-center gap-3 justify-between">
                        <div className="flex items-center gap-3">
                            {post.authorPicture ? (
                                <img src={post.authorPicture} alt="Profile" className="w-10 h-10 rounded-full object-cover" />
                            ) : (
                                <div className="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-semibold">
                                    {post.authorName.charAt(0).toUpperCase()}
                                </div>
                            )}
                            <div>
                                <h3 className="font-semibold text-lg text-indigo-600">{post.authorName}</h3>
                                <p className="text-sm text-gray-500">{post.timestamp.toLocaleString()}</p>
                            </div>
                        </div>
                        {post.userId === userId && (
                            <button
                                onClick={() => confirmDeletePost(post)}
                                className="text-red-500 text-sm font-semibold hover:text-red-700 transition-colors"
                            >
                                Delete
                            </button>
                        )}
                    </div>

                    {post.text && <p className="text-gray-700 leading-relaxed">{post.text}</p>}
                    {post.imageUrl && (
                        <div className="rounded-lg overflow-hidden border border-gray-200 shadow-sm">
                            <img src={post.imageUrl} alt="User post" className="w-full h-auto max-h-96 object-contain" />
                        </div>
                    )}

                    <div className="flex items-center gap-4 text-gray-500 text-sm">
                        <button
                            onClick={handleLike}
                            className={`flex items-center gap-1 transition-transform hover:scale-105 ${userHasLiked ? 'text-red-500' : 'text-gray-500'}`}
                        >
                            <span className="text-xl">❤️</span> {post.likes} Likes
                        </button>
                        <button
                            onClick={() => setShowComments(!showComments)}
                            className="flex items-center gap-1 transition-transform hover:scale-105"
                        >
                            <span className="text-xl">💬</span> {post.comments.length} Comments
                        </button>
                    </div>

                    {showComments && (
                        <div className="flex flex-col gap-4 mt-2">
                            {post.comments.length > 0 ? (
                                post.comments.map(comment => (
                                    <div key={comment.id} className="bg-gray-50 p-3 rounded-lg border border-gray-100">
                                        <p className="font-semibold text-sm text-gray-700">{comment.authorName}</p>
                                        <p className="text-sm text-gray-600 mt-1">{comment.text}</p>
                                        <p className="text-xs text-gray-400 mt-1">{comment.timestamp.toLocaleString()}</p>
                                    </div>
                                ))
                            ) : (
                                <p className="text-gray-400 text-sm italic text-center">No comments yet.</p>
                            )}

                            <div className="flex gap-2 mt-2">
                                <input
                                    type="text"
                                    value={newCommentText}
                                    onChange={(e) => setNewCommentText(e.target.value)}
                                    placeholder="Write a comment..."
                                    className="flex-1 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                    onKeyPress={(e) => e.key === 'Enter' && handleAddComment()}
                                />
                                <button
                                    onClick={handleAddComment}
                                    disabled={!newCommentText.trim()}
                                    className="bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg transition-transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    Post
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const DeleteConfirmationModal = ({ onConfirm, onCancel }) => (
            <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop">
                <div className="bg-white rounded-xl shadow-lg p-6 max-w-sm w-full text-center">
                    <h2 className="text-xl font-bold text-red-600">Confirm Deletion</h2>
                    <p className="text-gray-700 mt-2">Are you sure you want to delete this post? This action cannot be undone.</p>
                    <div className="mt-6 flex justify-center gap-4">
                        <button
                            onClick={onCancel}
                            className="px-6 py-2 bg-gray-300 text-gray-800 rounded-full transition-transform hover:scale-105"
                        >
                            Cancel
                        </button>
                        <button
                            onClick={onConfirm}
                            className="px-6 py-2 bg-red-600 text-white rounded-full transition-transform hover:scale-105"
                        >
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        );

        // Mount the React application
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>